<div class="page">
  <div class="card card--wide">

    <!-- ✅ Header toujours visible -->
    <div class="header">
      <div>
        <h2>Patients</h2>
        <p class="subtitle">Gestion des patients (ajout, modification, suppression).</p>
      </div>

      <!-- ✅ Toujours visible même si 0 patient -->
      <a routerLink="/patients/new" class="btn btn-add">+ Ajouter</a>
    </div>

    <!-- ✅ Search toujours visible -->
    <input
      class="search"
      placeholder="Rechercher par nom / CIN / téléphone..."
      [(ngModel)]="query"
      (ngModelChange)="refresh()"
    />

    <!-- Table seulement si patients existent -->
    <table class="table" *ngIf="patients.length > 0; else empty">
      <thead>
        <tr>
          <th>Nom complet</th>
          <th>CIN</th>
          <th>Téléphone</th>
          <th>Date naissance</th>
          <th>Adresse</th>
          <th class="th-actions">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let p of patients">
          <td>{{ p.fullName }}</td>
          <td>{{ p.cin }}</td>
          <td>{{ p.phone }}</td>
          <td>{{ p.birthDate }}</td>
          <td>{{ p.address }}</td>

          <td class="row-actions">
            <a class="link" [routerLink]="['/patients', p.id, 'edit']">Modifier</a>

            <!-- Bouton supprimer -->
            <button
              class="btn btn-danger"
              *ngIf="pendingDeleteId !== p.id"
              (click)="askDelete(p.id)"
            >
              Supprimer
            </button>

            <!-- Confirmation -->
            <div class="confirm" *ngIf="pendingDeleteId === p.id">
              <span>Confirmer ?</span>
              <button class="btn btn-danger" (click)="confirmDelete()">Oui</button>
              <button class="btn btn-ghost" (click)="cancelDelete()">Non</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- ✅ Empty state, mais le bouton Ajouter reste visible en haut -->
    <ng-template #empty>
      <div class="empty">
        <p class="message">Aucun patient trouvé.</p>
        <p class="hint">Cliquez sur <strong>“Ajouter”</strong> pour créer le premier patient.</p>
      </div>
    </ng-template>
  </div>
</div>
